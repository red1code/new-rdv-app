"use strict";(self.webpackChunknew_rdv_app=self.webpackChunknew_rdv_app||[]).push([[36],{50:(A,v,i)=>{i.d(v,{R:()=>t});var t=(()=>{return(o=t||(t={})).PENDING="PENDING",o.APPROVED="APPROVED",o.FINISHED="FINISHED",o.CANCELED="CANCELED",o.DELETED="DELETED",t;var o})()},4286:(A,v,i)=>{i.d(v,{b:()=>h});var t=i(5861),o=i(50),_=i(4004),m=i(4650),g=i(7407),f=i(7694);let h=(()=>{class u{constructor(a,e){this.fireStore=a,this.translatingService=e}createRendezvous(a,e){var n=this;return(0,t.Z)(function*(){if(!e.email)throw"You need Email to create new Rendezvous!";return a.createdAt=new Date,a.createdBy=e.email,a.rdvState=o.R.PENDING,yield n.fireStore.collection("Rendezvous").add(a)})()}deleteRendezvous(a,e,n){var r=this;return(0,t.Z)(function*(){return e.createdAt=new Date(e.createdAt),e.lastUpdate&&"Not Updated"!==e.lastUpdate&&(e.lastUpdate=new Date(e.lastUpdate)),e.rdvState=o.R.DELETED,e.deletedAt=new Date,e.deletedBy=n.email,yield r.fireStore.collection("Rendezvous").doc(a).update(e)})()}updateRendezvous(a,e){var n=this;return(0,t.Z)(function*(){return e.lastUpdate=new Date,yield n.fireStore.collection("Rendezvous").doc(a).update(e)})()}approveRendezvous(a,e,n){var r=this;return(0,t.Z)(function*(){return e.createdAt=new Date(e.createdAt),e.lastUpdate&&"Not Updated"!==e.lastUpdate&&(e.lastUpdate=new Date(e.lastUpdate)),e.rdvState=o.R.APPROVED,e.approvedAt=new Date,e.approvedBy=n.email,yield r.fireStore.collection("Rendezvous").doc(a).update(e)})()}finishRendezvous(a,e){var n=this;return(0,t.Z)(function*(){return e.createdAt=new Date(e.createdAt),e.lastUpdate&&"Not Updated"!==e.lastUpdate&&(e.lastUpdate=new Date(e.lastUpdate)),e.approvedAt&&(e.approvedAt=new Date(e.approvedAt)),e.rdvDate&&(e.rdvDate=new Date(e.rdvDate)),e.rdvState=o.R.FINISHED,e.finishedAt=new Date,yield n.fireStore.collection("Rendezvous").doc(a).update(e)})()}cancelRendezvous(a,e,n){var r=this;return(0,t.Z)(function*(){return e.createdAt=new Date(e.createdAt),e.lastUpdate&&"Not Updated"!==e.lastUpdate&&(e.lastUpdate=new Date(e.lastUpdate)),e.approvedAt&&(e.approvedAt=new Date(e.approvedAt)),e.rdvDate&&(e.rdvDate=new Date(e.rdvDate)),e.rdvState=o.R.CANCELED,e.canceledAt=new Date,e.canceledBy=n.email,yield r.fireStore.collection("Rendezvous").doc(a).update(e)})()}getRDVsByState(a,e,n,r){return this.fireStore.collection("Rendezvous",c=>{const s=c.where("rdvState","==",a).orderBy(e).limit(5);return"NEXT"===n?s.startAfter(r):"PREVIOUS"===n?s.endBefore(r):s}).snapshotChanges().pipe((0,_.U)(c=>{let s=1;return c.map(d=>{const p=d.payload.doc.data();return{...p,rdvID:d.payload.doc.id,createdAt:this.translatingService.convertToDateString(p.createdAt),lastUpdate:this.getLastUpdate(p.lastUpdate),rdvDate:p.rdvDate?this.translatingService.convertToDateString(p.rdvDate):void 0,approvedAt:p.approvedAt?this.translatingService.convertToDateString(p.approvedAt):void 0,finishedAt:p.finishedAt?this.translatingService.convertToDateString(p.finishedAt):void 0,canceledAt:p.canceledAt?this.translatingService.convertToDateString(p.canceledAt):void 0,deletedAt:p.deletedAt?this.translatingService.convertToDateString(p.deletedAt):void 0,order:s++}})}))}getRDVsByEmailAndState(a,e,n){return this.fireStore.collection("Rendezvous",r=>r.where("createdBy","==",a).where("rdvState","==",e).orderBy(n)).snapshotChanges().pipe((0,_.U)(r=>{let c=1;return r.map(s=>{const d=s.payload.doc.data();return{...d,rdvID:s.payload.doc.id,createdAt:this.translatingService.convertToDateString(d.createdAt),lastUpdate:this.getLastUpdate(d.lastUpdate),rdvDate:d.rdvDate?this.translatingService.convertToDateString(d.rdvDate):void 0,approvedAt:d.approvedAt?this.translatingService.convertToDateString(d.approvedAt):void 0,finishedAt:d.finishedAt?this.translatingService.convertToDateString(d.finishedAt):void 0,canceledAt:d.canceledAt?this.translatingService.convertToDateString(d.canceledAt):void 0,deletedAt:d.deletedAt?this.translatingService.convertToDateString(d.deletedAt):void 0,order:c++}})}))}getAllRendezvous(){return this.fireStore.collection("Rendezvous",a=>a.orderBy("createdAt")).snapshotChanges().pipe((0,_.U)(a=>{let e=1;return a.map(n=>{const r=n.payload.doc.data();return{...r,rdvID:n.payload.doc.id,createdAt:this.translatingService.convertToDateString(r.createdAt),lastUpdate:this.getLastUpdate(r.lastUpdate),rdvDate:r.rdvDate?this.translatingService.convertToDateString(r.rdvDate):void 0,approvedAt:r.approvedAt?this.translatingService.convertToDateString(r.approvedAt):void 0,finishedAt:r.finishedAt?this.translatingService.convertToDateString(r.finishedAt):void 0,canceledAt:r.canceledAt?this.translatingService.convertToDateString(r.canceledAt):void 0,deletedAt:r.deletedAt?this.translatingService.convertToDateString(r.deletedAt):void 0,order:e++}})}))}getDocByID(a){return this.fireStore.collection("Rendezvous").doc(a)}getLastUpdate(a){return a&&"Not Updated"!==a?this.translatingService.convertToDateString(a):"Not Updated"}}return u.\u0275fac=function(a){return new(a||u)(m.LFG(g.ST),m.LFG(f.o))},u.\u0275prov=m.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},362:(A,v,i)=>{i.d(v,{X:()=>e});var t=i(4650),o=i(4006),_=i(6895),m=i(6188);function g(n,r){1&n&&(t.TgZ(0,"p",10),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"invalid name")))}function f(n,r){1&n&&(t.TgZ(0,"p",10),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Phone Number must contain 10 digit numbers")))}function h(n,r){1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Add Rendezvous")))}function u(n,r){1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Update Rendezvous")))}function l(n,r){if(1&n){const c=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){t.CHM(c);const d=t.oxw();return t.KtG(d.deleteRDV())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Delete Rendezvous")))}const a=function(n){return{"full-width-btn":n}};let e=(()=>{class n{constructor(c){this.formBuilder=c,this.rdvFormValue=new t.vpe,this.deleteRDVid=new t.vpe}ngOnInit(){this.rdvID=this.rdv?.rdvID,this.initForm()}initForm(){const c=this.rdv?.displayName,s=this.rdv?.phoneNumber;this.rdvform=this.formBuilder.group({displayName:[c,[o.kI.required,o.kI.pattern(/.*\S.*/)]],phoneNumber:[s,[o.kI.required,o.kI.pattern(/^(\+213|0)?[0-9]{9}$/)]]})}submitForm(){this.rdvform.invalid||this.rdvFormValue.emit(this.rdvform.value)}deleteRDV(){this.deleteRDVid.emit(this.rdvID)}}return n.\u0275fac=function(c){return new(c||n)(t.Y36(o.QS))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-rdv-form"]],inputs:{rdv:"rdv",showDeleteBtn:"showDeleteBtn"},outputs:{rdvFormValue:"rdvFormValue",deleteRDVid:"deleteRDVid"},decls:14,vars:16,consts:[[1,"form",3,"formGroup"],[1,"name-div"],["type","text","formControlName","displayName",1,"input-form",3,"placeholder"],["class","danger-msg",4,"ngIf"],[1,"mobile-div"],["type","tel","formControlName","phoneNumber",1,"input-form",3,"placeholder"],[1,"btns-container"],[1,"btn","btn-success",3,"disabled","ngClass","click"],[4,"ngIf"],["class","btn btn-danger",3,"click",4,"ngIf"],[1,"danger-msg"],[1,"btn","btn-danger",3,"click"]],template:function(c,s){1&c&&(t.TgZ(0,"form",0)(1,"div",1),t._UZ(2,"input",2),t.ALo(3,"translate"),t.YNc(4,g,3,3,"p",3),t.qZA(),t.TgZ(5,"div",4),t._UZ(6,"input",5),t.ALo(7,"translate"),t.YNc(8,f,3,3,"p",3),t.qZA(),t.TgZ(9,"div",6)(10,"button",7),t.NdJ("click",function(){return s.submitForm()}),t.YNc(11,h,3,3,"span",8),t.YNc(12,u,3,3,"span",8),t.qZA(),t.YNc(13,l,3,3,"button",9),t.qZA()()),2&c&&(t.Q6J("formGroup",s.rdvform),t.xp6(2),t.s9C("placeholder",t.lcZ(3,10,"Enter a name")),t.xp6(2),t.Q6J("ngIf",s.rdvform.controls.displayName.touched&&s.rdvform.controls.displayName.invalid),t.xp6(2),t.s9C("placeholder",t.lcZ(7,12,"Phone Number")),t.xp6(2),t.Q6J("ngIf",s.rdvform.controls.phoneNumber.touched&&s.rdvform.controls.phoneNumber.invalid),t.xp6(2),t.Q6J("disabled",s.rdvform.invalid)("ngClass",t.VKq(14,a,!s.rdvID||!s.showDeleteBtn)),t.xp6(1),t.Q6J("ngIf",!s.rdvID),t.xp6(1),t.Q6J("ngIf",s.rdvID),t.xp6(1),t.Q6J("ngIf",s.rdvID&&s.showDeleteBtn))},dependencies:[_.mk,_.O5,o._Y,o.Fj,o.JJ,o.JL,o.sg,o.u,m.X$],styles:[".name-div[_ngcontent-%COMP%], .mobile-div[_ngcontent-%COMP%], .error-msg-div[_ngcontent-%COMP%]{margin:15px 0}.btns-container[_ngcontent-%COMP%]{display:flex;margin-top:25px}.btn[_ngcontent-%COMP%]{width:50%}.full-width-btn[_ngcontent-%COMP%]{width:100%}.btn-success[_ngcontent-%COMP%]{margin-right:7px}.btn-danger[_ngcontent-%COMP%]{margin-left:7px}"]}),n})()},6912:(A,v,i)=>{i.d(v,{a:()=>f});var t=i(4650),o=i(5415),_=i(7579),m=i(6518),g=i(6188);let f=(()=>{class h{constructor(l,a){this.authService=l,this.translate=a,this.updateInfosEvent=new t.vpe,this.loadMoreData=new t.vpe,this.dtOptions={},this.dtTrigger=new _.x,this.tableBTNs=e=>e?[{extend:"colvis",className:"export-btns"},{extend:"csv",className:"export-btns"},{extend:"excel",className:"export-btns"}]:[]}ngOnChanges(l){l.infos&&this.rerenderTable()}ngOnInit(){this.dtOptions=this.tableOptions(this.infos,this.tableCols,this.currentUser?.email,this.showBtns),window.onresize=()=>this.rerenderTable()}ngAfterViewInit(){this.dtTrigger.next(this.dtOptions)}ngOnDestroy(){this.dtTrigger.unsubscribe()}tableOptions(l,a,e,n){return{data:l,columns:a,responsive:!0,pagingType:"full_numbers",pageLength:5,lengthMenu:[3,5,10,25,50,100],dom:"Bfrtip",initComplete:(r,c)=>{$("button").removeClass("dt-button"),$("button").removeClass("buttons-excel"),$("button").removeClass("buttons-html5 "),$("#DataTables_Table_0_next").on("click",()=>this.loadMoreData.emit())},buttons:this.tableBTNs(n),rowCallback:(r,c,s)=>{const d=this;$(r).addClass("t-row"),$(r).css({"white-space":"nowrap"});let p=c;if(p.createdBy===e||this.canCRUD){const D=document.createElement("button");D.textContent=this.translate.instant("Edit"),D.setAttribute("id","tableBtn"),D.classList.add("btn","btn-dark"),D.onclick=()=>d.updateInfosEvent.emit(p);const E=$(r.lastChild);E.addClass("row-btn-container"),E.children("button").remove(),E.append(D)}return r},language:{processing:this.translate.instant("Processing..."),search:this.translate.instant("Search:"),lengthMenu:this.translate.instant("Show _MENU_ entries"),info:this.translate.instant("Showing _START_ to _END_ of _TOTAL_ entries"),infoEmpty:this.translate.instant("Showing 0 to 0 of 0 entries"),infoFiltered:this.translate.instant("(filtered from _MAX_ total entries)"),infoPostFix:"",loadingRecords:this.translate.instant("Loading..."),zeroRecords:this.translate.instant("No matching records found"),emptyTable:this.translate.instant("No data available in table"),paginate:{first:this.translate.instant("First"),previous:this.translate.instant("Previous"),next:this.translate.instant("Next"),last:this.translate.instant("Last")},aria:{sortAscending:this.translate.instant(": activate to sort column ascending"),sortDescending:this.translate.instant(": activate to sort column descending")}}}}rerenderTable(){this.dtOptions&&this.dtElement&&this.dtElement.dtInstance.then(l=>{l.destroy(),this.dtOptions.data=this.infos,this.dtTrigger.next(this.dtOptions)})}get canCRUD(){return this.authService.canCRUDrendezvous(this.currentUser)}}return h.\u0275fac=function(l){return new(l||h)(t.Y36(m.e),t.Y36(g.sK))},h.\u0275cmp=t.Xpm({type:h,selectors:[["app-table"]],viewQuery:function(l,a){if(1&l&&t.Gf(o.G,5),2&l){let e;t.iGM(e=t.CRH())&&(a.dtElement=e.first)}},inputs:{infos:"infos",tableCols:"tableCols",currentUser:"currentUser",showBtns:"showBtns"},outputs:{updateInfosEvent:"updateInfosEvent",loadMoreData:"loadMoreData"},features:[t.TTD],decls:2,vars:2,consts:[[2,"overflow","scroll","overflow-y","hidden","padding","5px"],["datatable","",1,"table","table-responsive","row-border",2,"color","var(--template-color)",3,"dtOptions","dtTrigger"]],template:function(l,a){1&l&&(t.TgZ(0,"div",0),t._UZ(1,"table",1),t.qZA()),2&l&&(t.xp6(1),t.Q6J("dtOptions",a.dtOptions)("dtTrigger",a.dtTrigger))},dependencies:[o.G]}),h})()}}]);